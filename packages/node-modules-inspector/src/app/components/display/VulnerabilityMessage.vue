<script setup lang="ts">
import type { PackageNode } from 'node-modules-tools'
import { computed } from 'vue'
import { getVulnerability } from '../../state/payload'

const props = withDefaults(defineProps<{
  pkg: PackageNode
  showTitle?: boolean
}>(), {
  showTitle: true,
})

const vulnerability = computed(() => getVulnerability(props.pkg))
</script>

<template>
  <a
    v-if="vulnerability"
    px3 py2 block
    :href="vulnerability.url"
    :class="vulnerability.level !== 'critical' ? 'badge-color-orange' : 'badge-color-red'"
    target="_blank"
  >
    <div
      v-if="showTitle"
      flex="~ gap-1 items-center"
      text-sm font-bold
      :class="vulnerability.level !== 'critical' ? 'text-orange' : 'text-red'"
    >
      <div :class="vulnerability.level !== 'critical' ? 'i-ph-warning-circle-duotone' : 'i-ph-warning-duotone'" flex-none />
      <div rounded-full font-mono>
        Package has vulnerability
      </div>
    </div>
    <div text-sm>
      {{ vulnerability.title }}
    </div>
  </a>
</template>
